<link rel="import" href="../property-mixins/datetime-mixin.html">
<link rel="import" href="../input-picker-pattern/form-element-mixin.html">

<script>
  /**
   * Mixin to extend an element for picking date or time to locale formating and hiding certain datetime-properties
   *
   * @appliesMixin DatetimeMixin
   * @appliesMixin FormElementMixin
   *
   * @mixinFunction
   * @polymer
   *
   * @param {Object} superClass class to extend
   * @return {Object} extended class
   */
  const DatetimeInputMixin = superClass => { // eslint-disable-line no-unused-vars

    return class extends DatetimeMixin(FormElementMixin(superClass)) { // eslint-disable-line no-undef

      static get template() {
        return `
          ${this.styleTemplate}
          <div id="input">
            ${this.inputTemplate}
          </div>
        `
      }

      static get styleTemplate() {
        return `
          <style include="${this.customStyleToInclude}">
            ${this.customStyleContent}
          </style>
        `;
      }

      static get customStyleToInclude() {
        return '';
      }

      static get customStyleContent() {
        return `
          ${super.customStyleToInclude || ''}
          :host {
            display: inline-flex;
            outline: none;
          }
          :host([disabled]) {
            pointer-events: none;
          }
          #input {
            outline: none;
            padding: 0.1em 0.15em;
            border-radius: 4px;
            border: thin dotted transparent;
            line-height: normal;
            @apply --input-style;
            display: inline-flex;
            align-items: baseline;
            -webkit-background-clip: padding-box;
            background-clip: padding-box;
          }
          #input:hover,
          #input:focus {
            @apply --input-focus;
          }
          :host([invalid]) #input {
            border: thin dotted var(--input-invalid-color, red);
            @apply --input-invalid;
          }
          #input integer-input {
            outline: none;
            --number-input-focus: {
              outline: none;
              color: var(--input-focus-color, inherit);
              background: var(--input-focus-background, rgba(0,0,0,0.1));
              @apply --input-focus;
              border-color: transparent;
            };
            --number-input: {
              border-radius: 2px;
              padding: 0.15em;
              cursor: pointer;
              transition: background 250ms cubic-bezier(0.6, 1, 0.2, 1);
              @apply --input-style;
              -webkit-background-clip: padding-box;
              background-clip: padding-box;
              border-color: transparent;
            };
            --number-input-placeholder: {
              color: rgba(0,0,0,0.334);
              @apply --input-placeholder;
            };
          }
          #input .reset {
            display: inline-flex;
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            margin-left: 1px;
            cursor: pointer;
            border-width: 0;
            box-sizing: content-box;
            order: 13;
            opacity: 0.5;
            color: var(--input-color, inherit);
            background: transparent;
            transition: background 250ms cubic-bezier(0.6, 1, 0.2, 1);
            height: 12px;
            width: 12px;
            border-radius: 50%;
            padding: 2px;
          }
          #input .reset > svg {
            height: 100%;
            width: 100%;
            fill: currentColor;
          }
          #input .reset:focus,
          #input .reset:hover {
            opacity: 1;
            @apply --input-focus;
            border-width: 0;
            outline: none;
          }
          [hidden] {
            display: none !important;
          }
          [invisible] {
            visibility: hidden;
          }
        `;
      }

      /**
       * template for the focusable
       * @type {string}
       */
      static get inputTemplate() {
        return '<button class="icon reset" invisible$="[[!_valueIsSet]]" hidden$="[[disabled]]" tabindex="0" on-click="_resetDate"><svg viewBox="0 0 24 24"><g><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></g></svg></button>';
      }

      static get properties() {
        return {

          _valueIsSet: {
            type: Boolean,
            value: false
          }

        }
      }

      static get observers() {
        return [
          '_computeValueIsSet(value)'
        ]
      }

      _computeInvalid(required, value) {
        this.invalid = required && isNaN(value);
      }

    }
  }
</script>
