<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../number-input/integer-input.html">

<link rel="import" href="datetime-input-mixin.html">

<script>
  /**
   *
   * Mixin to extend an element to a date input
   *
   * @mixinFunction
   * @polymer
   *
   * @demo demo/index.html
   * @demo demo/form.html Form
   **/
  const DateInputPattern = superClass => { // eslint-disable-line no-unused-vars

    return class extends superClass { // eslint-disable-line no-undef

      static get inputTemplate() {
        return `
          <div style$="order:[[_computePartOrder(dateOrder.dateFirst)]];" tabindex>
            <integer-input id="year" value="{{year}}" style$="order:[[dateOrder.year]];" tabindex$="[[dateOrder.year]]" hidden$="[[partsHidden.year]]" pad-length="4" placeholder="−−−−" disabled="[[partsDisabled.year]]"></integer-input>
            <span style="order:2;" hidden$="[[_edgeIsHidden(dateOrder, partsHidden.year, partsHidden.month, partsHidden.day, 'true')]]">[[dateSeparator]]</span>
            <integer-input id="month" value="{{month}}" style$="order:[[dateOrder.month]];" tabindex$="[[dateOrder.month]]" hidden$="[[partsHidden.month]]" pad-length="2" placeholder="−−" disabled="[[partsDisabled.month]]"></integer-input>
            <span style="order:4;" hidden$="[[_edgeIsHidden(dateOrder, partsHidden.year, partsHidden.month, partsHidden.day)]]">[[dateSeparator]]</span>
            <integer-input id="day" value="{{day}}" style$="order:[[dateOrder.day]];" tabindex$="[[dateOrder.day]]" hidden$="[[partsHidden.day]]" no-clamp pad-length="2" placeholder="−−" step="[[partsStep.day]]" disabled="[[partsDisabled.day]]"></integer-input>
          </div>
          ${super.inputTemplate || ''}
        `;
      }

      static get properties() {
        return {
          /**
           * Clamp datetime to a property
           * possible values:'month', 'day', 'hour', 'minute', 'second', 'millisecond'
           */
          clamp: {
            type: String,
            value: 'hour',
            notify: true
          }
        }
      }

      connectedCallback() {
        super.connectedCallback();
        let d;
        if (this.default) {
          d = new Date(this.default);
        }
        if (isNaN(d)) {
          d = new Date();
        }
        this.$.year.startAt = d.getFullYear();
        this.$.month.startAt = d.getMonth() + 1;
        this.$.day.startAt = d.getDate();
      }

      _edgeIsHidden(order, yearHidden, monthHidden, dayHidden, leftToRight) {
        if (order === undefined) {
          return true; // hide if not fully initialized
        }
        if (yearHidden + monthHidden + dayHidden >= 2) {
          return true; // more than two are hidden
        }
        if (leftToRight) {
          if (order.year < order.month) {
            if (order.year < order.day) {
              return Boolean(yearHidden);
            } else {
              return Boolean(dayHidden);
            }
          } else {
            if (order.month < order.day) {
              return Boolean(monthHidden);
            } else {
              return Boolean(dayHidden);
            }
          }
        } else {
          if (order.year > order.month) {
            if (order.year > order.day) {
              return Boolean(yearHidden);
            } else {
              return Boolean(dayHidden);
            }
          } else {
            if (order.month > order.day) {
              return Boolean(monthHidden);
            } else {
              return Boolean(dayHidden);
            }
          }
        }
      }

    }
  }
</script>

<dom-module id="date-input">
  <script>
    /**
     *  `<date-input>` is an input for time for **[Polymer](https://github.com/Polymer/polymer)**
     *
     *  ```html
     *    <date-input value="{{value}}"></date-input>
     *  ```
     *
     * Custom property | Description | Default
     * ----------------|-------------|----------
     * `--input-color`                    | color of the input                             | inherit
     * `--input-background`               | background of the input                        | transparent
     * `--input-border-width`             | border width of the input                      | thin
     * `--input-border-style`             | border style of the input                      | dotted
     * `--input-border-color`             | border color of the input                      | transparent
     * `--input-padding`                  | padding of the input                           | 0.2em
     * `--input-border-radius`            | border-radius of the input                     | 0.25em
     * `--input-transition`               | transition of the input                        | background 250ms cubic-bezier(0.6, 1, 0.2, 1)
     * `--input-allign`                   | text-allign of the input input                 | center
     * `--input-cursor`                   | cursor of the input input                      | initial
     * `--input-focus-color`              | color of the focussed and hovered input        | inherit
     * `--input-focus-background`         | background of the focussed and hovered input   | rgba(0, 0, 0, 0.16)
     * `--input-focus-border-style`       | border style of the focussed and hovered input | dotted
     * `--input-focus-border-color`       | border color of the focussed and hovered input | currentColor
     * `--input-invalid-color`            | color of the invalid input                     | inherit
     * `--input-invalid-background`       | background of the invalid input                | rgba(255, 0, 0, 0.16)
     * `--input-invalid-border-style`     | border style of the invalid input              | dotted
     * `--input-invalid-border-color`     | border color of the invalid input              | rgba(255, 0, 0, 0.5)
     * `--input-disabled-color`           | color of the disabled input                    | inherit
     * `--input-disabled-background`      | background of the disabled input               | transparent
     * `--input-disabled-font-style`      | font-style of the disabled input               | italic
     * `--input-disabled-opacity`         | opacity of the disabled input                  | 1
     * `--input-placeholder-color`        | color of the placeholder                       | inherit
     * `--input-placeholder-opacity`      | opacity of the placeholder                     | 0.75
     * `--input-selection-color`          | color of the selected text                     | inherit
     * `--input-selection-background`     | background of the selected text                | rgba(255, 255, 255, 0.5)
     * `--input-style`                    | style of the input                             | {}
     * `--input-focus`                    | style of the focussed and hovered input        | {}
     * `--input-invalid`                  | style of the invalid input                     | {}
     * `--input-placeholder`              | style of the placeholder                       | {}
     * `--inner-input-color`              | color of the inner inputs                      | inherit
     * `--inner-input-background`         | background of the inner inputs                        | transparent
     * `--inner-input-border-width`       | border width of the inner inputs                      | thin
     * `--inner-input-border-style`       | border style of the inner inputs                      | dotted
     * `--inner-input-border-color`       | border color of the inner inputs                      | transparent
     * `--inner-input-padding`            | padding of the inner inputs                           | 0.16em
     * `--inner-input-border-radius`      | border-radius of the inner inputs                     | 0.16em
     * `--inner-input-focus-color`        | color of the focussed and hovered inner inputs        | inherit
     * `--inner-input-focus-background`   | background of the focussed and hovered inner inputs   | rgba(0, 0, 0, 0.16)
     * `--inner-input-focus-border-style` | border style of the focussed and hovered inner inputs | dotted
     * `--inner-input-focus-border-color` | border color of the focussed and hovered inner inputs | currentColor
     *
     *  @polymer
     *  @customElement
     *
     *  @appliesMixin DateInputPattern
     *  @appliesMixin DatetimeInputMixin
     *
     * @demo demo/index.html
     * @demo demo/form.html in a form
     **/
    class DateInput extends DateInputPattern(DatetimeInputMixin(Polymer.Element)) { // eslint-disable-line no-undef

      static get is() {
        return 'date-input';
      }

      _dateTimeChanged(date, time) {
        if (this.__updatingTimezoneOffset) {
          return;
        }
        if (date === undefined) {
          if (this.default !== undefined) {
            this._setDate(new Date(this.default));
          } else {
            this._resetDate();
          }
          return;
        }
        this.datetime = date + 'T' + (time || '00:00') + (this.timezone || 'Z');
      }

    }
    window.customElements.define(DateInput.is, DateInput);
  </script>
</dom-module>
