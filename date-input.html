<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../number-input/integer-input.html">

<link rel="import" href="datetime-input-mixin.html">

<script>
  /**
   *
   * Mixin to extend an element to a date input
   *
   * @mixinFunction
   * @polymer
   *
   * @demo demo/index.html
   * @demo demo/form.html Form
   **/
  const DateInputPattern = superClass => { // eslint-disable-line no-unused-vars

    return class extends superClass { // eslint-disable-line no-undef

      static get inputTemplate() {
        return `
          <integer-input id="year" style$="order:[[_orderDate.year]];" tabindex$="[[_orderDate.year]]" hidden$="[[_partsHidden.year]]" pad-length="4" placeholder="- - - -" disabled="[[disabled]]" value="{{year}}"></integer-input>
          <span style$="order:[[_orderDate.separatorYearMonth]];" hidden$="[[_or(_partsHidden.month, _partsHidden.year)]]">[[_localDateSeparator]]</span>
          <integer-input id="month" style$="order:[[_orderDate.month]];" tabindex$="[[_orderDate.month]]" hidden$="[[_partsHidden.month]]" pad-length="2" placeholder="- -" min="1" max="12" disabled="[[disabled]]" value="{{month}}"></integer-input>
          <span style$="order:[[_orderDate.separatorMonthDay]];" hidden$="[[_or(_partsHidden.month, _partsHidden.day)]]">[[_localDateSeparator]]</span>
          <integer-input id="day" style$="order:[[_orderDate.day]];" tabindex$="[[_orderDate.day]]" hidden$="[[_partsHidden.day]]" pad-length="2" placeholder="- -" min="1" max="[[_maxDayOfMonth]]" disabled="[[disabled]]" value="{{day}}"></integer-input>
          ${super.inputTemplate || ''}
        `;
      }

      static get properties() {
        return {
          /**
           * Clamp datetime to a property
           * possible values:'month', 'day', 'hours', 'minutes', 'seconds', 'milliseconds'
           */
          clamp: {
            type: String,
            value: 'hours'
          }
        }
      }

      connectedCallback() {
        super.connectedCallback();
        let d;
        if (this.default) {
          d = new Date(this.default);
        }
        if (isNaN(d)) {
          d = new Date();
        }
        this.$.year.startAt = d.getFullYear();
        this.$.month.startAt = d.getMonth() + 1;
        this.$.day.startAt = d.getDate();
      }

      _or(a, b) {
        return a || b;
      }

    }
  }
</script>

<dom-module id="date-input">
  <script>
    /**
     *  `<date-input>` is an input for time for **[Polymer](https://github.com/Polymer/polymer)**
     *
     *  ```html
     *    <date-input value="{{value}}"></date-input>
     *  ```
     *
     * Custom property | Description | Default
     * ----------------|-------------|----------
     * `--input-color` | text-color of the inputs | ``
     * `--input-background` | text-color of the inputs | ``
     * `--input-focus-color` | color of the focussed or hovered inputs | ``
     * `--input-focus-background` | background of the focussed or hovered inputs | `--primary-color, rgba(0,0,0,0.2)
     * `--input-style` | Mixin applied to the inputs | {border-radius: 2px;padding: 0.2em 0.1em;cursor: pointer; transition: background 150ms cubic-bezier(0.6, 1, 0.2, 1);
     * `--input-focus` | Mixin applied to the focussed or hovered inputs | {}
     * `--input-invalid-color` | border-color of invalid inputs | red
     * `--input-invalid-color` |  Mixin applied to invalid inputs | {}
     *
     *  @polymer
     *  @customElement
     *
     *  @appliesMixin DateInputPattern
     *  @appliesMixin DatetimeInputMixin
     *
     * @demo demo/index.html
     * @demo demo/form.html in a form
     **/
    class DateInput extends DateInputPattern(DatetimeInputMixin(Polymer.Element)) { // eslint-disable-line no-undef

      static get is() {
        return 'date-input';
      }

      _dateTimeChanged(date, time) {
        if (this.__updatingTimezoneOffset) {
          return;
        }
        if (date === undefined) {
          if (this.default !== undefined) {
            this._setDate(new Date(this.default));
          } else {
            this._resetDate();
          }
          return;
        }
        this.datetime = date + 'T' + (time || '00:00') + (this.timezone || 'Z');
      }

    }
    window.customElements.define(DateInput.is, DateInput);
  </script>
</dom-module>
