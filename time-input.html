<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../number-input/integer-input.html">

<link rel="import" href="datetime-input-mixin.html">

<script>
  /**
   *
   * Mixin to extend an element to a time input
   *
   * @demo demo/index.html
   * @demo demo/form.html Form
   **/
  const TimeInputPattern = (superClass) => { // eslint-disable-line no-unused-vars

    return class extends superClass { // eslint-disable-line no-undef

      static get inputTemplate() {
        return `
          ${super.inputTemplate || ''}
          <div hidden$="[[_hideHours]]" class="hours" style="order:7;">
            <integer-input hidden$="[[hour12]]" index="7" min="0" max="23" pad-length="2" value="{{hours}}" placeholder="00"></integer-input>
            <integer-input hidden$="[[!hour12]]" index="7" min="1" max="12" pad-length="2" value="{{hours12}}" placeholder="00"></integer-input>
          </div>
          <div hidden$="[[_hideMinutes]]" style="order:8;">
            <span>[[_localTimeSeparator]]</span>
            <integer-input index="9" pad-length="2" min="0" max="59" disabled="[[disabled]]" value="{{minutes}}" placeholder="00"></integer-input>
          </div>
          <div hidden$="[[_hideSeconds]]" style="order:9;">
            <span>[[_localTimeSeparator]]</span>
            <integer-input index="11" pad-length="2" min="0" max="59" disabled="[[disabled]]" value="{{seconds}}" placeholder="00"></integer-input>
          </div>
          <div hidden$="[[_hideMilliseconds]]" style="order:10;">
            <span>[[_localDecimalSeparator]]</span>
            <integer-input index="13" pad-length="3" min="0" max="999" disabled="[[disabled]]" value="{{milliseconds}}" placeholder="000"></integer-input>
          </div>
          <div class="single-switch" hidden$="[[!hour12]]" style="order:11;" on-mouseup="_switchAm">
            <span hidden$="[[!isAm]]">[[_am]]</span>
            <span hidden$="[[isAm]]">[[_pm]]</span>
          </div>
          <div hidden$="[[!withTimezone]]" style="order:12;">
            <integer-input index="13" pad-length="2" always-sign step="1" value="{{_timeZoneHours}}" placeholder="+00" min="-12" max="14"></integer-input>
            <span>[[_localTimeSeparator]]</span>
            <integer-input index="15" pad-length="2" min="0" max="45" step="15" value="{{_timeZoneMinutes}}" placeholder="00"></integer-input>
          </div>
        `;
      }

      static get customStyleContent() {
        return `
          ${super.customStyleContent || ''}
          :host > div {
            display: inline-flex;
            align-items: center;
          }
          integer-input ~ .hours {
            margin-left: 0.167em;
          }
          .single-switch {
            align-self: stretch;
            cursor: pointer;
            font-size: 0.8em;
            margin: 0 0.2em;
          }
        `
      }

      static get properties() {
        return {
          /**
           * Clamp timetime to a property
           * possible values:'month', 'day', 'hours', 'minutes', 'seconds', 'milliseconds'
           */
          clamp: {
            type: String,
            value: 'milliseconds'
          },

          withTimezone: {
            type: Boolean,
            value: false
          },

          _timeZoneHours: {
            type: Number
          },

          _timeZoneMinutes: {
            type: Number
          },

          _hideHours: {
            type: Boolean,
            computed: '_ifClamped(clamp, "hours")'
          },

          _hideMinutes: {
            type: Boolean,
            computed: '_ifClamped(clamp, "minutes")'
          },

          _hideSeconds: {
            type: Boolean,
            computed: '_ifClamped(clamp, "seconds")'
          },

          _hideMilliseconds: {
            type: Boolean,
            computed: '_ifClamped(clamp, "milliseconds")'
          }
        }
      }

      static get observers() {
        return [
          '_timeZoneHoursMinutesChanged(_timeZoneHours, _timeZoneMinutes) '
        ]
      }

      _switchAm() {
        this.isAm = !this.isAm;
      }

      offsetMinutesChanged(offsetMinutes) {
        if (offsetMinutes === undefined) {
          return;
        }

        super.offsetMinutesChanged(offsetMinutes);
        this.setProperties({
          _timeZoneHours: Math.floor(-offsetMinutes / 60),
          _timeZoneMinutes: Math.abs(offsetMinutes) % 60
        });

      }

      _timeZoneHoursMinutesChanged(_timeZoneHours, _timeZoneMinutes) {
        if (_timeZoneHours === undefined || _timeZoneMinutes === undefined) {
          return;
        }
        if (!this.__updatingValues) {
          this.__updatingValues = true;
          this.offsetMinutes = -(_timeZoneHours * 60 + _timeZoneMinutes);
          if (this.value !== undefined) {
            this._setDate(new Date(this.value));
          }
          this.__updatingValues = false;
        }
      }
    }
  }
</script>

<dom-module id="time-input">
  <script>
    /**
     *  `<time-input>` is an input for time for **[Polymer](https://github.com/Polymer/polymer)**
     *
     *  ```html
     *    <time-input value="{{value}}"></time-input>
     *  ```
     *
     * Custom property | Description | Default
     * ----------------|-------------|----------
     * `--input-color` | text-color of the inputs | ``
     * `--input-background` | text-color of the inputs | ``
     * `--input-focus-color` | color of the focussed or hovered inputs | ``
     * `--input-focus-background` | background-color of the focussed or hovered inputs | `--primary-color, rgba(0,0,0,0.2)`
     * `--input-style` | Mixin applied to the inputs | {border-radius: 2px;padding: 0.2em 0.1em;cursor: pointer; transition: background-color 150ms cubic-bezier(0.6, 1, 0.2, 1);`
     * `--input-focus` | Mixin applied to the focussed or hovered inputs | {}`
     *
     *  @polymer
     *  @customElement
     *
     *  @appliesMixin TimeInputPattern
     *  @appliesMixin DatetimeInputMixin
     *
     * @demo demo/index.html
     * @demo demo/form.html Form
     **/
    class TimeInput extends TimeInputPattern(DatetimeInputMixin(Polymer.Element)) { // eslint-disable-line no-undef

      static get is() {
        return 'time-input';
      }
    }
    window.customElements.define(TimeInput.is, TimeInput);
  </script>
</dom-module>
